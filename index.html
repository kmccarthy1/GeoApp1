<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Ten Most Improved Cities</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <link rel="stylesheet" href="/sidebar/L.Control.Sidebar.css" />
    <link rel="stylesheet" href="/markerCluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="/markerCluster/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="/mapFunction/defExtent/leaflet.defaultextent.css">

    <style>
        body {
                margin: 0;
                padding: 0;
            }

        #map {
                width: 100%;
                height: 100vh;
            }

        .coordinate {
                position: absolute;
                bottom: 10px;
                left: 2%
            }
    </style>

</head>
<body>
<div class="custom-popup" id="map"></div>
    <div class="leaflet-control coordinate" ></div>
        <div id="sidebar">
        <div id="tophalf" style="outline: 3px; outline-color: gray; outline-style: solid; padding: 8px; border-radius: 7px;" >
            <h1>Alt-Transportation Most Improved Cities</h1>
            <h2>A map of the US Top Ten Cities where ridership has grown the most in public transit, walking, and biking</h2>
            <div style = "">
                <img style="display: block; margin-left: auto; margin-right: auto;" src="/data/CN_pic.jpeg" alt="City Nerd Youtube Profile Photo" href="https://www.youtube.com/@CityNerd/videos">
            </div>
            <p>https://youtu.be/-Mh1UctlSOg</p>
        </div>
        <div id="bottomhalf" style="background-color: lightgreen;">

        </div>
    </div>
</body>


</html>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
<!--bringing in leaflet ajax-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/L.Geoserver.js"></script>
<script src="/sidebar/L.Control.Sidebar.js" ></script>
<script src="/markerCluster/dist/leaflet.markercluster.js" ></script>
<script src="/markerCluster/dist/leaflet.markercluster-src.js" ></script>
<script src="/mapFunction/defExtent/leaflet.defaultextent.js"></script>

<script>
    //map initialization
    var map = L.map('map', {
        center: [39.3508, -101.7102],
        zoom: 5.4,     
        zoomControl: true,
        dragging: true,
        touchZoom: true,
        doubleClickZoom: true,
        scrollWheelZoom: true,
        boxZoom: true,
        keyboard: true,
        tap: true,
        maxZoom: 15,
        defaultExtentControl: true
    });
//creating custom popups
    function customPopup(feature){
       return `<div> <h2 class="popupTitle"></b>${feature.properties.CityName} (Rank #${feature.properties.id})</h2> 
                <p class="popupType"><b>Net Transit Change: </b>${feature.properties.Transit}</p>
                <p class="popupSubType"><b>Net Walking Change: </b>${feature.properties.Walk}</p>
                <p class="popupSubType"><b>New Biking Change: </b>${feature.properties.Bike}</p>
               </div>`;
    }
//defining custom style for point data
    var NewPointStyle = {
    radius: 10,
    fillColor: "#03d3fc",
    color: "#000000",
    weight: 0.5,
    opacity: 1,
    fillOpacity: 0.8
    };
    //creating initial sidebar
    var sidebar = L.control.sidebar('sidebar', {
        closeButton: false,
        position: 'left',
        autoPan: true
    });
    map.addControl(sidebar);
    sidebar.show();
    var visible = sidebar.isVisible();

    //adding data from Geoserver
        // var wmsLayer = L.Geoserver.wms("http://localhost:8080/geoserver/wms", {
        //         layers: "FirstWorkspace:Most Improved Cities"
        //     });
        //     wmsLayer.addTo(map);
    //adding flat file data
    // var TopTenCities = new L.geoJson.ajax("/data/CN_TT.geojson");
            // TopTenCities.addTo(map);

    var markers = L.markerClusterGroup({
        spiderfyOnMaxZoom: true,
    });


    //adding city data from geojson and adding custom style
    var TopTenCities = new L.geoJson.ajax("/data/CN_TT.geojson", {
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, NewPointStyle);
        },
        onEachFeature:function(feature, layer){
            layer.bindPopup(customPopup(feature))
        }
    })
    TopTenCities.on('data:loaded', function () {
        markers.addLayer(TopTenCities);
    });
    map.addLayer(markers);

    L.control.scale().addTo(map);
    //adding osm layer
    var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        // osm.addTo(map);
    //adding dark layer
        var dark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png?api_key=7f6bc554-f1ae-4503-ab0d-1f2f4b13cf77', {
            maxZoom: 20,
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
        });
         dark.addTo(map);
    //adding cartography layer
        var carto = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20
        });
        //carto.addTo(map);


    </script>
